# 多設備共享功能說明

## 架構圖

```
手機 A ──────┐
             │
手機 B ──────┼────→ 伺服器 (192.168.x.x:3000) ────→ 資料庫 (sessions.json)
             │                                      影片檔案 (uploads/)
電腦瀏覽器 ──┘
```

## 功能確認

### ✅ 已實現的功能

1. **多手機上傳到同一伺服器**
   - 所有設備連接到相同的伺服器 IP 和端口
   - 上傳的影片存儲在伺服器的 `uploads/` 目錄
   - 會話資料存儲在伺服器的 `sessions.json` 文件

2. **共享資料庫**
   - 所有設備讀取同一個 `sessions.json` 文件
   - A 手機上傳的資料，B 手機刷新後可以看到
   - 刪除操作也會同步到所有設備

3. **影片播放**
   - 任何設備都可以播放任何設備上傳的影片
   - 影片從伺服器串流播放

## 使用步驟

### 1. 啟動伺服器

在電腦上運行：

```bash
cd /path/to/smartCamera
npm start
```

伺服器會顯示：
```
Server running on http://localhost:3000
Uploads directory: /path/to/smartCamera/uploads
```

### 2. 找到伺服器 IP

在電腦終端執行：

```bash
# macOS
ipconfig getifaddr en0

# 或
ifconfig | grep "inet " | grep -v 127.0.0.1
```

記下 IP 地址，例如：`192.168.1.100`

### 3. 手機連接

所有手機使用相同的 URL：

```
http://192.168.1.100:3000
```

**注意**：如果需要使用攝影機，手機可能需要 HTTPS 連線。

### 4. 驗證共享

1. **手機 A**：錄製一段影片並停止
2. **手機 B**：點擊「重新整理」或刷新頁面
3. **確認**：手機 B 應該可以看到手機 A 錄製的影片

## 技術說明

### API 端點

| 端點 | 方法 | 說明 |
|------|------|------|
| `/api/upload` | POST | 上傳影片 |
| `/api/sessions` | GET | 獲取所有會話 |
| `/api/video/:id` | GET | 獲取影片 |
| `/api/sessions/:id` | DELETE | 刪除會話 |
| `/api/status` | GET | 伺服器狀態 |

### 資料存儲

- **影片檔案**：`uploads/{sessionId}.webm`
- **會話資料**：`sessions.json`

### 並發處理

- 伺服器使用文件鎖機制避免並發寫入衝突
- 每次請求都重新讀取 `sessions.json` 確保數據最新

## 驗證伺服器連接

在任何設備的瀏覽器中訪問：

```
http://192.168.1.100:3000/api/status
```

應該看到：
```json
{
  "status": "ok",
  "serverTime": "2026-01-15T...",
  "totalSessions": 5,
  "clientIP": "...",
  "message": "所有连接到此服务器的设备共享同一个数据库"
}
```

## 常見問題

### Q: 手機看不到其他手機的資料？

**A**: 確認：
1. 所有手機使用相同的伺服器 URL
2. 點擊「重新整理」或刷新頁面
3. 檢查網路連線

### Q: 上傳失敗？

**A**: 檢查：
1. 伺服器是否正在運行
2. 手機是否能訪問伺服器 IP
3. 瀏覽器控制台的錯誤訊息

### Q: 無法播放影片？

**A**: 確認：
1. 影片已成功上傳到伺服器
2. 伺服器 `uploads/` 目錄中有對應的影片檔案
3. 網路連線正常

## 測試腳本

在瀏覽器控制台執行以下代碼測試連接：

```javascript
// 測試伺服器連接
fetch(API_BASE_URL + '/api/status')
  .then(r => r.json())
  .then(data => {
    console.log('伺服器狀態:', data);
    console.log('會話總數:', data.totalSessions);
  })
  .catch(err => console.error('連接失敗:', err));
```

